<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogo de Aprendizado de Ingl√™s</title>
    <!-- <link rel="stylesheet" href="style.css"> -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .tabs {
            display: flex;
            background: #f5f5f5;
            border-bottom: 1px solid #ddd;
        }

        .tab {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #666;
        }

        .tab.active {
            background: white;
            color: #4CAF50;
            border-bottom: 3px solid #4CAF50;
        }

        .tab:hover:not(.active) {
            background: #e8e8e8;
        }

        .content {
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }

        .voice-control {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f8f9fa;
            padding: 12px 20px;
            border-radius: 25px;
            border: 2px solid #e9ecef;
        }

        .voice-control input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #4CAF50;
        }

        .btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }

        .btn-secondary:hover {
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #f44336, #d32f2f);
        }

        .btn-danger:hover {
            box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4);
        }

        .game-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .status-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #4CAF50;
        }

        .status-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .status-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4CAF50;
        }

        .game-area {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            min-height: 400px;
        }

        .question {
            font-size: 1.4rem;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            line-height: 1.6;
        }

        .english-phrase {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2196F3;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border-left: 5px solid #2196F3;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .answer-area {
            margin: 30px 0;
        }

        .answer-area h4 {
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .selected-words {
            min-height: 80px;
            background: white;
            border: 3px dashed #ddd;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
            justify-content: center;
            transition: border-color 0.3s ease;
        }

        .selected-words.has-words {
            border-color: #4CAF50;
            border-style: solid;
        }

        .selected-words.empty {
            align-items: center;
            justify-content: center;
            color: #999;
            font-style: italic;
        }

        .word-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .word-btn {
            background: linear-gradient(135deg, #FF9800, #F57C00);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 80px;
        }

        .word-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.4);
        }

        .word-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .selected-word {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .selected-word:hover {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            transform: translateY(-1px);
        }

        .game-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .phrases-list {
            max-height: 441px;
            overflow-y: auto;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
        }

        .phrase-item {
            background: white;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .phrase-content {
            flex: 1;
            min-width: 250px;
        }

        .phrase-english {
            font-weight: bold;
            color: #2196F3;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .phrase-portuguese {
            color: #666;
        }

        .phrase-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .form-group {
            display: flex;
            margin-bottom: 20px;
            flex-direction: column;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 100vh;
            /* altura m√°xima da tela */
            overflow-y: auto;
            /* scroll interno se necess√°rio */
            position: relative;
            animation: modalSlideIn 0.3s ease;
            box-sizing: border-box;
            /* evita problemas de padding */
        }


        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .close {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #999;
        }

        .close:hover {
            color: #333;
        }

        .feedback {
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
            display: none;
            animation: feedbackSlideIn 0.3s ease;
        }

        @keyframes feedbackSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .game-complete {
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border-radius: 15px;
            margin: 20px 0;
        }

        .game-complete h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .game-complete p {
            font-size: 1.3rem;
            margin-bottom: 30px;
        }

        /* Filtros do Jogo */
        .game-filters {
            display: flex;
            gap: 15px;
            align-items: center;
            margin: 0 15px;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #555;
        }

        .filter-group select {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 0.9rem;
            background: white;
            cursor: pointer;
            min-width: 120px;
        }

        .filter-group select:focus {
            border-color: #4CAF50;
            outline: none;
        }

        /* Indicadores de dificuldade */
        .difficulty-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            color: white;
            margin-left: 8px;
        }

        .difficulty-f√°cil {
            background-color: #4CAF50;
        }

        .difficulty-m√©dio {
            background-color: #FF9800;
        }

        .difficulty-dif√≠cil {
            background-color: #f44336;
        }

        .difficulty-extremo {
            background-color: #9C27B0;
        }

        .category-badge {
            background-color: #2196F3;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 8px;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .controls .btn {
            white-space: nowrap;
        }

        #importFile {
            display: none;
        }


        /* Estilos do Sistema de N√≠veis */
        .xp-bar {
            width: 100%;
            height: 8px;
            background: #ddd;
            border-radius: 4px;
            overflow: hidden;
            margin: 5px 0;
        }

        .xp-progress {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #2196F3);
            transition: width 0.5s ease;
        }

        .xp-text {
            font-size: 0.8rem;
            color: #666;
        }

        .player-title {
            font-size: 0.8rem;
            color: #FF9800;
            font-weight: bold;
        }

        .level-up-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease;
        }

        .level-up-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: levelUpBounce 0.6s ease;
        }

        .level-change {
            font-size: 3rem;
            font-weight: bold;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .old-level {
            color: #ffeb3b;
        }

        .new-level {
            color: #4caf50;
            animation: glow 1s ease-in-out infinite alternate;
        }

        .reward {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .xp-bar-big {
            width: 200px;
            height: 12px;
            background: #ddd;
            border-radius: 6px;
            overflow: hidden;
            margin: 10px auto;
        }

        .titles-list {
            font-size: 0.8rem;
            color: #FF9800;
            margin-top: 5px;
        }

        .score-detail {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }

        .streak-bonus {
            font-size: 0.8rem;
            color: #FF9800;
            margin-top: 3px;
        }

        .status-card.streak-card {
            border-left: 4px solid #FF5722;
            background: linear-gradient(135deg, rgba(255, 87, 34, 0.1), rgba(255, 152, 0, 0.1));
        }

        .status-card.level-card {
            border-left: 4px solid #2196F3;
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.1), rgba(103, 58, 183, 0.1));
        }

        .multiple-choice-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 20px 0;
        }

        .choice-btn {
            padding: 15px 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            font-size: 16px;
            text-align: left;
            transition: all 0.3s ease;
        }

        .choice-btn:hover {
            background: #f0f8ff;
            border-color: #4CAF50;
            transform: translateY(-2px);
        }

        .choice-btn.correct {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .choice-btn.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .choice-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        select {
            width: 100%;
            /* ocupa toda a largura do container */
            padding: 10px 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: white;
            font-size: 16px;
            appearance: none;
            /* remove o estilo padr√£o do sistema */
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="gray" height="20" viewBox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 16px;
            cursor: pointer;
        }


        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes levelUpBounce {
            0% {
                transform: scale(0.5) translateY(50px);
                opacity: 0;
            }

            50% {
                transform: scale(1.1) translateY(-10px);
            }

            100% {
                transform: scale(1) translateY(0);
                opacity: 1;
            }
        }

        @keyframes glow {
            from {
                text-shadow: 0 0 5px #4caf50;
            }

            to {
                text-shadow: 0 0 20px #4caf50, 0 0 30px #4caf50;
            }
        }


        @media (max-width: 768px) {
            .container {
                min-height: 872px;
                margin: -13px;
                border-radius: 15px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .content {
                padding: 20px;
            }

            .voice-control {
                justify-content: center;
            }

            .phrase-item {
                flex-direction: column;
                align-items: stretch;
            }

            .phrase-actions {
                justify-content: center;
            }

            .tabs {
                flex-direction: column;
            }

            .modal-content {
                margin: 10% auto;
                width: 95%;
                padding: 20px;
            }

            .game-status {
                grid-template-columns: repeat(2, 1fr);
            }

            .word-btn,
            .selected-word {
                font-size: 0.9rem;
                padding: 10px 15px;
            }

            .controls {
                display: flex;
                flex-direction: row;
                justify-content: space-evenly;
            }

        }

        @media (max-width: 600px) {
            .status-card.streak-card .status-value {
                display: block;
                width: 100%;
                box-sizing: border-box;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üéì English Learning Game</h1>
            <!-- <p>Monte as frases na ordem correta!</p> -->
        </div>

        <div class="tabs">
            <button class="tab active" data-tab="game">Jogar</button>
            <button class="tab" data-tab="manage">Gerenciar Frases</button>
        </div>

        <div class="content">
            <!-- Game Tab -->
            <div id="game" class="tab-content active">
                <div class="controls">
                    <div class="voice-control">
                        <input type="checkbox" id="enableVoice" checked>
                        <label for="enableVoice">üîä Falar</label>
                    </div>

                    <!-- NOVOS FILTROS -->
                    <div class="game-filters">
                        <div class="filter-group">
                            <label for="categorySelect">üìÇ Categoria:</label>
                            <select id="categorySelect">
                                <option value="all">Todas</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="difficultySelect">‚≠ê Dificuldade:</label>
                            <select id="difficultySelect">
                                <option value="all">Todas</option>
                            </select>
                        </div>
                    </div>

                    <button class="btn" onclick="startGame()">Novo Jogo</button>
                    <button class="btn btn-secondary" onclick="resetRound()" id="resetBtn" style="display: none;">üîÑ
                        Resetar</button>
                </div>

                <div class="game-status">
                    <div class="status-card">
                        <h3>Pontua√ß√£o</h3>
                        <div class="status-value">
                            <span id="currentScore">0</span> / <span id="totalQuestions">0</span>
                        </div>
                    </div>
                    <div class="status-card">
                        <h3>Pergunta</h3>
                        <div class="status-value">
                            <span id="currentQuestionNum">0</span> / <span id="totalPhrases">0</span>
                        </div>
                    </div>
                    <div class="status-card">
                        <h3>Restantes</h3>
                        <div class="status-value" id="remainingQuestions">0</div>
                    </div>
                </div>

                <div class="game-area">
                    <div id="gameContent">
                        <div style="text-align: center; padding: 40px;">
                            <h2>üéÆ Clique em "Novo Jogo" para come√ßar!</h2>
                            <p>Monte as palavras na ordem correta para formar a tradu√ß√£o em portugu√™s.</p>
                        </div>
                    </div>
                </div>

                <div class="feedback" id="feedback"></div>
            </div>

            <!-- Manage Tab -->
            <div id="manage" class="tab-content">
                <div class="controls">
                    <button class="btn" onclick="openAddModal()">‚ûï Adicionar</button>
                    <button class="btn btn-secondary" onclick="exportPhrases()">üì§ Exportar</button>
                    <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">üì•
                        Importar</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;"
                        onchange="importPhrases(event)">
                    <button class="btn btn-danger" onclick="clearAllPhrases()">üóëÔ∏è Deletar</button>
                </div>

                <div class="phrases-list" id="phrasesList">
                    <!-- Phrases will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Modal -->
    <div id="phraseModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Adicionar Nova Frase</h2>
            <form id="phraseForm">
                <div class="form-group">
                    <label for="englishPhrase" id="labelEnglish">Frase em Ingl√™s:</label>
                    <input type="text" id="englishPhrase" required>
                </div>
                <div class="form-group">
                    <label for="portugueseTranslation" id="labelPortuguese">Tradu√ß√£o em Portugu√™s:</label>
                    <input type="text" id="portugueseTranslation" required>
                </div>
                <!-- ADICIONAR ESTES NOVOS CAMPOS: -->
                <div class="form-group">
                    <label for="categorySelect2">üìÇ Categoria:</label>
                    <select id="categorySelect2" required>
                        <option value="">Selecione uma categoria</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="difficultySelect2">‚≠ê Dificuldade:</label>
                    <select id="difficultySelect2" required>
                        <option value="">Selecione a dificuldade</option>
                    </select>
                    <label for="gameTypeSelect">Tipo de Jogo:</label>
                    <select id="gameTypeSelect" required>
                        <option value="">Selecione o tipo</option>
                    </select>
                    <label for="questionDirection">Dire√ß√£o da Pergunta:</label>
                    <select id="questionDirection" required>
                        <option value="">Selecione a dire√ß√£o</option>
                        <option value="en-pt">Ingl√™s ‚Üí Portugu√™s</option>
                        <option value="pt-en">Portugu√™s ‚Üí Ingl√™s</option>
                    </select>
                    <div id="customOptionsContainer" style="display: none;">
                        <label for="customOptions">Op√ß√µes de Resposta (uma por linha):</label>
                        <textarea id="customOptions"
                            placeholder="Digite uma op√ß√£o por linha...&#10;Exemplo:&#10;Bom dia!&#10;Boa tarde!&#10;Boa noite!&#10;Ol√°!"
                            rows="4"></textarea>
                        <small>Inclua a resposta correta entre as op√ß√µes</small>
                    </div>
                </div>

                <div class="controls">
                    <button type="submit" class="btn">Salvar</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
    <template id="endGameTemplate">
        <div class="game-complete">
            <h2>üéÆ Jogo Conclu√≠do!</h2>
            <p class="end-message"></p>

            <div class="score-summary">
                <div class="score-item">
                    <span class="score-label">Pontua√ß√£o da Rodada:</span>
                    <span class="score-value" id="roundScore"></span>
                </div>
                <div class="score-item">
                    <span class="score-label">Acertos:</span>
                    <span class="score-value" id="correctAnswers"></span>
                </div>
                <div class="score-item">
                    <span class="score-label">Maior Sequ√™ncia:</span>
                    <span class="score-value" id="maxStreak"></span>
                </div>
                <div class="score-item">
                    <span class="score-label">Pontua√ß√£o Total:</span>
                    <span class="score-value" id="totalScore"></span>
                </div>
                <div class="score-item bonus" id="perfectBonusContainer" style="display: none;">
                    <span class="score-label">üèÜ Bonus Perfeito:</span>
                    <span class="score-value" id="perfectBonus"></span>
                </div>
            </div>

            <button class="btn" onclick="startGame()" style="font-size: 1.2rem; padding: 15px 30px;">
                üîÑ Jogar Novamente
            </button>
            <button class="btn btn-secondary" onclick="showStats()" style="margin-left: 10px;">
                üìä Ver Estat√≠sticas
            </button>
        </div>
    </template>

    <div id="gameContent"></div>

    <template id="statsTemplate">
        <div class="stats-view">
            <h2>üìä Suas Estat√≠sticas</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" data-stat="totalScore"></div>
                    <div class="stat-label">Pontos Totais</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" data-stat="gamesPlayed"></div>
                    <div class="stat-label">Jogos Jogados</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" data-stat="avgScore"></div>
                    <div class="stat-label">M√©dia por Jogo</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" data-stat="accuracy"></div>
                    <div class="stat-label">Precis√£o</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" data-stat="maxStreak"></div>
                    <div class="stat-label">Maior Sequ√™ncia</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" data-stat="correctAnswers"></div>
                    <div class="stat-label">Total de Acertos</div>
                </div>
            </div>
            <div class="stat-card level-card-big">
                <div class="stat-number">‚≠ê <span data-stat="level"></span></div>
                <div class="stat-label">N√≠vel Atual</div>
                <div class="level-progress">
                    <div class="xp-bar-big">
                        <div class="xp-progress" data-stat="xpProgress" style="width: 0%"></div>
                    </div>
                    <small><span data-stat="currentXP"></span>/<span data-stat="xpNeeded"></span> XP</small>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-number" data-stat="totalXP"></div>
                <div class="stat-label">XP Total</div>
            </div>
            <div class="stat-card titles-card" id="titlesCard" style="display:none;">
                <div class="stat-number" data-stat="titlesCount"></div>
                <div class="stat-label">T√≠tulos Conquistados</div>
                <div class="titles-list" data-stat="titlesList"></div>
            </div>
            <div style="margin-top: 30px;">
                <button class="btn" onclick="startGame()">üéÆ Novo Jogo</button>
                <button class="btn btn-secondary" onclick="resetStats()" style="margin-left: 10px;">üîÑ Resetar
                    Estat√≠sticas</button>
            </div>
        </div>
    </template>

    <!-- <script src="script.js"></script> -->
    <script>
        // ==========================================
        // 1. CONFIGURA√á√ïES E CONSTANTES
        // ==========================================

        // Array principal de frases
        let phrases = [/* dados das frases */
            {
                "id": 1,
                "english": "This is an apple.",
                "portuguese": "Isto √© uma ma√ß√£.",
                "difficulty": "f√°cil",
                "category": "frutas",
                "type": "selection"
            }
        ];

        //Constantes do sistema
        const DIFFICULTIES = ['f√°cil', 'm√©dio', 'dif√≠cil', 'extremo'];
        const CATEGORIES = {/* categorias */
            'frutas': 'Frutas',
            'animais': 'Animais',
            'cores': 'Cores',
            'n√∫meros': 'N√∫meros',
            'fam√≠lia': 'Fam√≠lia',
            'casa': 'Casa',
            'comida': 'Comida',
            'frases-gerais': 'Frases Gerais'
        };
        const SCORE_SYSTEM = {// sistema de pontua√ß√£o, Sistema de Score Avan√ßado
            points: {
                'f√°cil': 10,
                'm√©dio': 20,
                'dif√≠cil': 30,
                'extremo': 50
            },
            bonuses: {
                perfectRound: 100,    // Bonus por acertar tudo
                streak: 5,           // Bonus por sequ√™ncia
                fastAnswer: 10       // Bonus por resposta r√°pida
            }
        };
        const LEVEL_SYSTEM = {/* sistema de n√≠veis */
            baseXP: 100,        // XP necess√°rio para o n√≠vel 1
            multiplier: 1.5,    // Multiplicador de XP por n√≠vel
            maxLevel: 50,       // N√≠vel m√°ximo
            rewards: {
                1: { type: 'unlock', message: 'Bem-vindo ao jogo!' },
                5: { type: 'bonus', value: 100, message: 'üéâ Bonus de 100 pontos!' },
                10: { type: 'unlock', message: 'üîì Modo dif√≠cil desbloqueado!' },
                15: { type: 'bonus', value: 250, message: 'üéÅ Bonus de 250 pontos!' },
                20: { type: 'unlock', message: 'üèÜ Modo extremo desbloqueado!' },
                25: { type: 'bonus', value: 500, message: 'üíé Bonus de 500 pontos!' },
                30: { type: 'title', value: 'Poliglota', message: 'üëë T√≠tulo desbloqueado: Poliglota!' },
                40: { type: 'bonus', value: 1000, message: 'üåü Mega bonus de 1000 pontos!' },
                50: { type: 'title', value: 'Mestre', message: 'üèÖ T√≠tulo m√°ximo: Mestre dos Idiomas!' }
            }
        };
        const GAME_TYPES = {//tipo da pergunta
            'selection': 'Sele√ß√£o de Palavras',
            'multiple': 'M√∫ltipla Escolha'
        };
        const QUESTION_DIRECTIONS = {//dire√ßao da pergunta ingles portugues > portugues ingles
            'en-pt': 'Ingl√™s ‚Üí Portugu√™s',
            'pt-en': 'Portugu√™s ‚Üí Ingl√™s'
        };

        // Estados globais
        let playerStats = {/* estat√≠sticas do jogador */
            totalScore: 0,
            gamesPlayed: 0,
            questionsAnswered: 0,
            correctAnswers: 0,
            streak: 0,
            maxStreak: 0,
            scoreHistory: [],
            // Novos campos para n√≠veis
            level: 1,
            currentXP: 0,
            totalXP: 0,
            titles: [],
            currentTitle: null
        };
        let gameState = {/* estado atual do jogo */
            availableQuestions: [],
            currentQuestion: null,
            selectedWords: [],
            score: 0,
            totalQuestions: 0,
            currentQuestionNum: 0,
            gameActive: false,
            // Novos campos para score avan√ßado
            currentStreak: 0,
            roundStartTime: null,
            roundScore: 0
        };
        let editingId = null;

        // IndexedDB functions, Configura√ß√µes do IndexedDB
        const DB_NAME = 'EnglishLearningGame';
        const DB_VERSION = 1;
        const STORE_NAME = 'phrases';

        let db;

        // ==========================================
        // 2. FUN√á√ïES DE INICIALIZA√á√ÉO
        // ==========================================
        // Inicializar banco de dados
        async function initDB() {/* inicializa IndexedDB */
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);

                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };

                request.onupgradeneeded = (event) => {
                    db = event.target.result;
                    if (!db.objectStoreNames.contains(STORE_NAME)) {
                        const store = db.createObjectStore(STORE_NAME, { keyPath: 'id' });
                        store.createIndex('category', 'category', { unique: false });
                        store.createIndex('difficulty', 'difficulty', { unique: false });
                    }
                };
            });
        }
        // Carregar estat√≠sticas salvas
        function loadPlayerStats() {/* carrega stats do localStorage */
            try {
                const saved = localStorage.getItem('playerStats');
                if (saved) {
                    playerStats = { ...playerStats, ...JSON.parse(saved) };
                }
            } catch (error) {
                console.error('Erro ao carregar estat√≠sticas:', error);
            }
        }
        // Inicializar dropdowns de sele√ß√£o  
        function initializeDropdowns() {/* preenche selects de categoria/dificuldade */
            const categorySelect = document.getElementById('categorySelect');
            const difficultySelect = document.getElementById('difficultySelect');
            const categorySelect2 = document.getElementById('categorySelect2');
            const difficultySelect2 = document.getElementById('difficultySelect2');

            // Preencher categorias
            Object.keys(CATEGORIES).forEach(key => {
                const option1 = new Option(CATEGORIES[key], key);
                const option2 = new Option(CATEGORIES[key], key);
                categorySelect.add(option1);
                categorySelect2.add(option2);
            });

            // Preencher dificuldades
            DIFFICULTIES.forEach(difficulty => {
                const option1 = new Option(difficulty.charAt(0).toUpperCase() + difficulty.slice(1), difficulty);
                const option2 = new Option(difficulty.charAt(0).toUpperCase() + difficulty.slice(1), difficulty);
                difficultySelect.add(option1);
                difficultySelect2.add(option2);
            });
            // Preencher tipos de jogo
            const gameTypeSelect = document.getElementById('gameTypeSelect');
            Object.keys(GAME_TYPES).forEach(key => {
                const option = new Option(GAME_TYPES[key], key);
                gameTypeSelect.add(option);
            });
            // Preencher dire√ß√µes de pergunta
            const questionDirectionSelect = document.getElementById('questionDirection');
            Object.keys(QUESTION_DIRECTIONS).forEach(key => {
                const option = new Option(QUESTION_DIRECTIONS[key], key);
                questionDirectionSelect.add(option);
            });
        }
        // Fun√ß√£o principal de inicializa√ß√£o
        async function init() {/* inicializa toda a aplica√ß√£o */
            try {
                await initDB();
                await mergePhrases(); // Usar mergePhrases em vez de loadPhrases
                loadPlayerStats(); // ‚úÖ CORRETO
                initializeDropdowns();
                loadPhrasesList();
                updateGameStatus();
                document.getElementById('gameTypeSelect').addEventListener('change', toggleCustomOptions);
                console.log(`${phrases.length} frases carregadas`);
            } catch (error) {
                console.error('Erro ao inicializar:', error);
                // Fallback para dados em mem√≥ria se IndexedDB falhar
                initializeDropdowns();
                loadPhrasesList();
                updateGameStatus();
            }
        }
        // ==========================================
        // 3. FUN√á√ïES DE GERENCIAMENTO DE DADOS
        // ==========================================
        // Salvar frases no IndexedDB
        async function savePhrases() {/* salva frases no banco */
            const transaction = db.transaction([STORE_NAME], 'readwrite');
            const store = transaction.objectStore(STORE_NAME);

            // Clear existing data
            await store.clear();

            // Add all phrases
            for (const phrase of phrases) {
                await store.add(phrase);
            }
        }
        // Carregar frases do IndexedDB
        async function loadPhrases() {/* carrega frases do banco */
            const transaction = db.transaction([STORE_NAME], 'readonly');
            const store = transaction.objectStore(STORE_NAME);
            const request = store.getAll();

            return new Promise((resolve, reject) => {
                request.onsuccess = () => {
                    const dbPhrases = request.result;

                    // Se n√£o h√° frases no IndexedDB, usar as frases do script
                    if (dbPhrases.length === 0 && phrases.length > 0) {
                        // Salvar as frases iniciais no IndexedDB
                        savePhrases().then(() => {
                            console.log('Frases iniciais salvas no IndexedDB');
                            resolve(phrases);
                        });
                    } else {
                        // Usar as frases do IndexedDB
                        phrases = dbPhrases;
                        resolve(phrases);
                    }
                };
                request.onerror = () => reject(request.error);
            });
        }
        // Mesclar frases (script + banco)
        async function mergePhrases() {/* combina frases do script com banco */
            const transaction = db.transaction([STORE_NAME], 'readonly');
            const store = transaction.objectStore(STORE_NAME);
            const request = store.getAll();

            return new Promise((resolve, reject) => {
                request.onsuccess = async () => {
                    const dbPhrases = request.result;

                    if (dbPhrases.length === 0) {
                        // Se IndexedDB est√° vazio, usar frases do script
                        console.log('IndexedDB vazio, usando frases do script');
                        await savePhrases();
                        resolve(phrases);
                    } else {
                        // Se IndexedDB tem dados, verificar se h√° frases novas no script
                        const dbIds = new Set(dbPhrases.map(p => p.id));
                        const newPhrases = phrases.filter(p => !dbIds.has(p.id));

                        if (newPhrases.length > 0) {
                            console.log(`Encontradas ${newPhrases.length} novas frases no script`);
                            // Mesclar frases novas
                            phrases = [...dbPhrases, ...newPhrases];
                            await savePhrases();
                        } else {
                            // Use apenas as frases do IndexedDB
                            phrases = dbPhrases;
                        }
                        resolve(phrases);
                    }
                };
                request.onerror = () => reject(request.error);
            });
        }
        // Salvar estat√≠sticas
        function savePlayerStats() {/* salva stats no localStorage */
            try {
                localStorage.setItem('playerStats', JSON.stringify(playerStats));
            } catch (error) {
                console.error('Erro ao salvar estat√≠sticas:', error);
            }
        }
        // ==========================================
        // 4. SISTEMA DE PONTUA√á√ÉO E N√çVEIS
        // ==========================================
        // Calcular XP necess√°rio para n√≠vel
        function getXPForLevel(level) {/* calcula XP por n√≠vel */
            if (level <= 1) return 0;
            return Math.floor(LEVEL_SYSTEM.baseXP * Math.pow(LEVEL_SYSTEM.multiplier, level - 2));
        }
        // XP necess√°rio para pr√≥ximo n√≠vel
        function getXPNeededForNextLevel(currentLevel) {/* XP para subir */
            return getXPForLevel(currentLevel + 1);
        }
        // XP total acumulado at√© n√≠vel
        function getTotalXPForLevel(level) {/* XP total do n√≠vel */
            let total = 0;
            for (let i = 1; i <= level; i++) {
                total += getXPForLevel(i);
            }
            return total;
        }
        // Adicionar XP ao jogador
        function addXP(amount) {/* adiciona XP e verifica level up */
            const oldLevel = playerStats.level;
            playerStats.currentXP += amount;
            playerStats.totalXP += amount;

            // Verificar se subiu de n√≠vel
            const xpNeeded = getXPNeededForNextLevel(playerStats.level);
            if (playerStats.currentXP >= xpNeeded && playerStats.level < LEVEL_SYSTEM.maxLevel) {
                levelUp(oldLevel);
            }

            savePlayerStats();
            return playerStats.level > oldLevel;
        }
        // Subir de n√≠vel
        function levelUp(oldLevel) {/* processo de subir n√≠vel */
            playerStats.currentXP -= getXPNeededForNextLevel(oldLevel);
            playerStats.level++;

            // Verificar recompensas
            const reward = LEVEL_SYSTEM.rewards[playerStats.level];
            if (reward) {
                processLevelReward(reward, playerStats.level);
            }

            showLevelUpAnimation(oldLevel, playerStats.level);
        }
        // Processar recompensas de n√≠vel
        function processLevelReward(reward, level) {/* aplica recompensas */
            switch (reward.type) {
                case 'bonus':
                    playerStats.totalScore += reward.value;
                    break;
                case 'title':
                    if (!playerStats.titles.includes(reward.value)) {
                        playerStats.titles.push(reward.value);
                        if (!playerStats.currentTitle) {
                            playerStats.currentTitle = reward.value;
                        }
                    }
                    break;
                case 'unlock':
                    // Funcionalidades desbloqueadas ser√£o tratadas na UI
                    break;
            }
        }
        // Anima√ß√£o de level up
        function showLevelUpAnimation(oldLevel, newLevel) {/* mostra anima√ß√£o */
            const levelUpDiv = document.createElement('div');
            levelUpDiv.className = 'level-up-animation';
            levelUpDiv.innerHTML = `
        <div class="level-up-content">
            <h2>üéâ LEVEL UP! üéâ</h2>
            <div class="level-change">
                <span class="old-level">${oldLevel}</span>
                <span class="arrow">‚Üí</span>
                <span class="new-level">${newLevel}</span>
            </div>
            <p>Parab√©ns! Voc√™ alcan√ßou o n√≠vel ${newLevel}!</p>
            ${LEVEL_SYSTEM.rewards[newLevel] ? `<p class="reward">${LEVEL_SYSTEM.rewards[newLevel].message}</p>` : ''}
        </div>
    `;

            document.body.appendChild(levelUpDiv);

            setTimeout(() => {
                levelUpDiv.remove();
            }, 4000);

            speak(`Parab√©ns! Voc√™ subiu para o n√≠vel ${newLevel}!`, 'pt');
        }
        // Calcular porcentagem de progresso
        function getProgressPercentage() {/* % para pr√≥ximo n√≠vel */
            if (playerStats.level >= LEVEL_SYSTEM.maxLevel) return 100;
            const xpNeeded = getXPNeededForNextLevel(playerStats.level);
            return Math.min(100, Math.round((playerStats.currentXP / xpNeeded) * 100));
        }
        // Calcular pontua√ß√£o da resposta
        function calculateScore(difficulty, isCorrect, timeSpent = 0) {/* calcula pontos */
            if (!isCorrect) return 0;

            let points = SCORE_SYSTEM.points[difficulty] || 10;

            // Bonus por resposta r√°pida (menos de 10 segundos)
            if (timeSpent < 10000) {
                points += SCORE_SYSTEM.bonuses.fastAnswer;
            }

            // Bonus por sequ√™ncia
            if (gameState.currentStreak >= 3) {
                points += SCORE_SYSTEM.bonuses.streak * Math.floor(gameState.currentStreak / 3);
            }

            return points;
        }
        // Atualizar sequ√™ncia de acertos
        function updateStreak(isCorrect) {/* gerencia streaks */
            if (isCorrect) {
                gameState.currentStreak++;
                playerStats.streak++;
                if (playerStats.streak > playerStats.maxStreak) {
                    playerStats.maxStreak = playerStats.streak;
                }
            } else {
                gameState.currentStreak = 0;
                playerStats.streak = 0;
            }
        }
        // ==========================================
        // 5. FUN√á√ïES DE IMPORTA√á√ÉO/EXPORTA√á√ÉO
        // ==========================================
        // Exportar frases para JSON, Import/Export functions
        function exportPhrases() {/* exporta dados */
            if (phrases.length === 0) {
                alert('N√£o h√° frases para exportar!');
                return;
            }

            const dataStr = JSON.stringify(phrases, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });

            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `english-phrases-${new Date().toISOString().split('T')[0]}.json`;
            link.click();

            URL.revokeObjectURL(link.href);
        }
        // Importar frases de arquivo
        async function importPhrases(event) {/* importa dados */
            const file = event.target.files[0];
            if (!file) return;

            try {
                const text = await file.text();
                const importedPhrases = JSON.parse(text);

                // Validate structure
                if (!Array.isArray(importedPhrases)) {
                    throw new Error('Formato inv√°lido: esperado um array de frases');
                }

                // Validate each phrase
                for (const phrase of importedPhrases) {
                    if (!phrase.english || !phrase.portuguese || !phrase.category || !phrase.difficulty) {
                        throw new Error('Formato inv√°lido: frases devem ter english, portuguese, category e difficulty');
                    }
                }

                // Verificar duplicatas por conte√∫do (n√£o por ID)
                const existingPhrases = new Set(phrases.map(p => `${p.english.toLowerCase()}|${p.portuguese.toLowerCase()}`));
                const newPhrases = importedPhrases.filter(phrase =>
                    !existingPhrases.has(`${phrase.english.toLowerCase()}|${phrase.portuguese.toLowerCase()}`)
                );

                if (newPhrases.length === 0) {
                    alert('‚ö†Ô∏è Nenhuma frase nova encontrada. Todas as frases j√° existem.');
                    event.target.value = '';
                    return;
                }

                // Generate new IDs to avoid conflicts
                const maxId = phrases.length > 0 ? Math.max(...phrases.map(p => p.id)) : 0;
                newPhrases.forEach((phrase, index) => {
                    phrase.id = maxId + index + 1;
                });

                // Merge with existing phrases
                phrases = [...phrases, ...newPhrases];

                // Save to IndexedDB
                await savePhrases();

                // Refresh display
                loadPhrasesList();

                const duplicates = importedPhrases.length - newPhrases.length;
                let message = `‚úÖ ${newPhrases.length} frases importadas com sucesso!`;
                if (duplicates > 0) {
                    message += `\n‚ö†Ô∏è ${duplicates} frases duplicadas foram ignoradas.`;
                }
                alert(message);

            } catch (error) {
                alert(`‚ùå Erro ao importar: ${error.message}`);
            }

            // Clear file input
            event.target.value = '';
        }
        // Fun√ß√£o para adicionar frases via script (para desenvolvedores)
        async function addPhrasesToScript(newPhrases) {/* adiciona por c√≥digo */
            if (!Array.isArray(newPhrases)) {
                console.error('addPhrasesToScript: par√¢metro deve ser um array');
                return;
            }

            const maxId = phrases.length > 0 ? Math.max(...phrases.map(p => p.id)) : 0;

            newPhrases.forEach((phrase, index) => {
                if (phrase.english && phrase.portuguese && phrase.category && phrase.difficulty) {
                    phrase.id = maxId + index + 1;
                    phrases.push(phrase);
                }
            });

            await savePhrases();
            loadPhrasesList();
            console.log(`${newPhrases.length} frases adicionadas via script`);
        }
        // ==========================================
        // 6. FUN√á√ïES DE NAVEGA√á√ÉO (TABS)
        // ==========================================

        // Tab functionality, Event listeners para tabs
        document.querySelectorAll('.tab').forEach(tab => {/* gerencia tabs */
            tab.addEventListener('click', () => {
                const targetTab = tab.dataset.tab;

                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

                tab.classList.add('active');
                document.getElementById(targetTab).classList.add('active');

                if (targetTab === 'manage') {
                    loadPhrasesList();
                }
            });
        });
        // ==========================================
        // 7. FUN√á√ïES DE √ÅUDIO E UTILIDADES
        // ==========================================
        // Speech synthesis functions, // Sintetizador de voz
        function speak(text, lang) {/* fala texto */
            if (!document.getElementById('enableVoice').checked) return;

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = lang === 'pt' ? 'pt-BR' : 'en-US';
            utterance.rate = 0.8;
            speechSynthesis.speak(utterance);
        }
        // Embaralhar array
        function shuffleArray(array) {/* randomiza ordem */
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }
        //multipla escolha
        // Gerar alternativas para m√∫ltipla escolha
        function generateMultipleChoiceOptions(correctAnswer, allPhrases, direction = 'en-pt') {
            const currentQuestion = gameState.currentQuestion;

            // Se a pergunta tem op√ß√µes customizadas, use elas
            if (currentQuestion.customOptions && currentQuestion.customOptions.length > 0) {
                return shuffleArray([...currentQuestion.customOptions]);
            }

            // Caso contr√°rio, use a l√≥gica original
            const options = [correctAnswer];
            const isEnglishToPortuguese = direction === 'en-pt';
            const availablePhrases = allPhrases.filter(p => {
                const phraseAnswer = isEnglishToPortuguese ? p.portuguese : p.english;
                return phraseAnswer !== correctAnswer && p.category === currentQuestion.category;
            });

            while (options.length < 4 && availablePhrases.length > 0) {
                const randomIndex = Math.floor(Math.random() * availablePhrases.length);
                const randomPhrase = availablePhrases.splice(randomIndex, 1)[0];
                const phraseAnswer = isEnglishToPortuguese ? randomPhrase.portuguese : randomPhrase.english;
                options.push(phraseAnswer);
            }

            if (options.length < 4) {
                const otherPhrases = allPhrases.filter(p => {
                    const phraseAnswer = isEnglishToPortuguese ? p.portuguese : p.english;
                    return phraseAnswer !== correctAnswer;
                });
                while (options.length < 4 && otherPhrases.length > 0) {
                    const randomIndex = Math.floor(Math.random() * otherPhrases.length);
                    const randomPhrase = otherPhrases.splice(randomIndex, 1)[0];
                    const phraseAnswer = isEnglishToPortuguese ? randomPhrase.portuguese : randomPhrase.english;
                    options.push(phraseAnswer);
                }
            }

            return shuffleArray(options);
        }
        // ==========================================
        // 8. FUN√á√ïES DE INTERFACE DO JOGO
        // ==========================================
        // Atualizar status visual do jogo
        function updateGameStatus() {/* atualiza UI com stats */
            document.getElementById('currentScore').textContent = gameState.score;
            document.getElementById('totalQuestions').textContent = gameState.totalQuestions;
            document.getElementById('currentQuestionNum').textContent = gameState.currentQuestionNum;
            document.getElementById('totalPhrases').textContent = phrases.length;
            document.getElementById('remainingQuestions').textContent = gameState.availableQuestions.length;

            // Adicionar informa√ß√£o de n√≠vel
            const statusCards = document.querySelector('.game-status');
            let levelCard = document.querySelector('.level-card');

            if (!levelCard) {
                levelCard = document.createElement('div');
                levelCard.className = 'status-card level-card';
                statusCards.appendChild(levelCard);
            }

            const progressPercent = getProgressPercentage();
            const nextLevelXP = getXPNeededForNextLevel(playerStats.level);

            levelCard.innerHTML = `
            <h3>‚≠ê N√≠vel ${playerStats.level}</h3>
            <div class="xp-bar">
                <div class="xp-progress" style="width: ${progressPercent}%"></div>
            </div>
            <div class="xp-text">${playerStats.currentXP}/${nextLevelXP} XP</div>
            ${playerStats.currentTitle ? `<div class="player-title">üëë ${playerStats.currentTitle}</div>` : ''}
            `;

            // Streak card (mant√©m o c√≥digo existente)
            let streakCard = document.querySelector('.streak-card');
            if (gameState.currentStreak > 0) {
                if (!streakCard) {
                    streakCard = document.createElement('div');
                    streakCard.className = 'status-card streak-card';
                    statusCards.appendChild(streakCard);
                }
                streakCard.innerHTML = `
            <h3>üî• Sequ√™ncia</h3>
            <div class="status-value">${gameState.currentStreak}</div>
            `;
            } else if (streakCard) {
                streakCard.remove();
            }
        }
        // Filtrar frases por categoria/dificuldade
        function getFilteredPhrases() {/* aplica filtros */
            const selectedCategory = document.getElementById('categorySelect').value;
            const selectedDifficulty = document.getElementById('difficultySelect').value;

            return phrases.filter(phrase => {
                const categoryMatch = selectedCategory === 'all' || phrase.category === selectedCategory;
                const difficultyMatch = selectedDifficulty === 'all' || phrase.difficulty === selectedDifficulty;
                return categoryMatch && difficultyMatch;
            });
        }
        // ==========================================
        // 9. FUN√á√ïES PRINCIPAIS DO JOGO
        // ==========================================
        // Iniciar novo jogo
        function startGame() {/* inicia partida */
            const filteredPhrases = getFilteredPhrases();

            if (phrases.length === 0) {
                alert('Adicione algumas frases primeiro na aba "Gerenciar Frases"');
                return;
            }

            if (filteredPhrases.length === 0) {
                alert('Nenhuma frase encontrada com os filtros selecionados. Tente outras op√ß√µes.');
                return;
            }

            gameState = {
                availableQuestions: [...filteredPhrases],
                currentQuestion: null,
                selectedWords: [],
                score: 0,
                totalQuestions: 0,
                currentQuestionNum: 0,
                gameActive: true
            };

            // Adicionar ap√≥s definir o gameState
            gameState.roundStartTime = Date.now();
            gameState.roundScore = 0;
            gameState.currentStreak = 0;

            updateGameStatus();
            nextQuestion();
        }
        // Pr√≥xima pergunta
        function nextQuestion() {/* carrega pr√≥xima quest√£o */
            if (gameState.availableQuestions.length === 0) {
                endGame();
                return;
            }

            // Get random question from available questions
            const randomIndex = Math.floor(Math.random() * gameState.availableQuestions.length);
            gameState.currentQuestion = gameState.availableQuestions[randomIndex];
            gameState.availableQuestions.splice(randomIndex, 1);

            gameState.totalQuestions++;
            gameState.currentQuestionNum++;
            gameState.selectedWords = [];

            gameState.roundStartTime = Date.now(); // Reset timer para cada pergunta

            updateGameStatus();
            renderQuestion();
            hideFeedback();

            // Show reset button
            document.getElementById('resetBtn').style.display = 'inline-block';
        }
        // Renderizar pergunta na tela
        function renderQuestion() {
            const gameContent = document.getElementById('gameContent');
            const questionType = gameState.currentQuestion.type || 'selection';

            if (questionType === 'multiple') {
                renderMultipleChoiceQuestion();
            } else {
                renderSelectionQuestion();
            }

            // Speak the question baseado na dire√ß√£o
            const direction = gameState.currentQuestion.direction || 'en-pt';
            setTimeout(() => {
                const questionType = gameState.currentQuestion.type || 'selection';

                if (direction === 'en-pt') {
                    if (questionType === 'selection') {
                        const words = gameState.currentQuestion.portuguese.split(' ');
                        const introText = words.length > 1 ? "Monte a frase corretamente" : "Qual o significado da palavra";
                        speak(introText, 'pt');
                    } else {
                        speak("Qual o significado de", 'pt');
                    }
                    setTimeout(() => {
                        // Aplicar regra de espa√ßos para a pergunta em ingl√™s
                        const englishWords = gameState.currentQuestion.english.split(' ');
                        const englishTextToSpeak = englishWords.every(word => word.length === 1)
                            ? gameState.currentQuestion.english.replace(/\s+/g, '')
                            : gameState.currentQuestion.english;
                        speak(englishTextToSpeak, 'en');
                    }, 1500);
                } else {
                    if (questionType === 'selection') {
                        const words = gameState.currentQuestion.english.split(' ');
                        const introText = words.length > 1 ? "Arrange the sentence correctly" : "What is the meaning of the word";
                        speak(introText, 'en');
                    } else {
                        speak("What is the meaning of", 'en');
                    }
                    setTimeout(() => {
                        // Aplicar regra de espa√ßos para a pergunta em portugu√™s
                        const portugueseWords = gameState.currentQuestion.portuguese.split(' ');
                        const portugueseTextToSpeak = portugueseWords.every(word => word.length === 1)
                            ? gameState.currentQuestion.portuguese.replace(/\s+/g, '')
                            : gameState.currentQuestion.portuguese;
                        speak(portugueseTextToSpeak, 'pt');
                    }, 1500);
                }
            }, 500);
        }
        // Renderizar pergunta de sele√ß√£o (modo atual)
        function renderSelectionQuestion() {
            const direction = gameState.currentQuestion.direction || 'en-pt';
            const isEnglishToPortuguese = direction === 'en-pt';

            const questionText = isEnglishToPortuguese ? gameState.currentQuestion.english : gameState.currentQuestion.portuguese;
            const answerText = isEnglishToPortuguese ? gameState.currentQuestion.portuguese : gameState.currentQuestion.english;
            const words = answerText.split(' ');
            const shuffledWords = shuffleArray(words);

            const answerWords = answerText.split(' ');
            const questionLabel = isEnglishToPortuguese
                ? (answerWords.length > 1 ? "Monte a frase corretamente:" : "Qual o significado da palavra:")
                : (answerWords.length > 1 ? "Arrange the sentence correctly:" : "What is the meaning of the word:");

            const instructionText = isEnglishToPortuguese
                ? (answerWords.length > 1 ? "üéØ Monte a frase na ordem correta:" : "üéØ Selecione as palavras para formar a tradu√ß√£o:")
                : (answerWords.length > 1 ? "üéØ Arrange the sentence in correct order:" : "üéØ Select the words to form the translation:");
            const gameContent = document.getElementById('gameContent');

            gameContent.innerHTML = `
                <div class="question">${questionLabel}</div>
                <div class="english-phrase">"${questionText}"</div>
                
                <div class="answer-area">
                    <h4>${instructionText}</h4>
                    <div class="selected-words empty" id="selectedWordsArea">
                        Clique nas palavras abaixo para formar a frase
                    </div>
                    
                    <div class="word-buttons" id="wordButtons">
                        ${shuffledWords.map((word, index) => `
                            <button class="word-btn" onclick="selectWord('${word}', ${index})" id="word-${index}">
                                ${word}
                            </button>
                        `).join('')}
                    </div>
                    
                    <div class="game-actions">
                        <button class="btn" onclick="checkAnswer()" id="checkBtn">‚úÖ Verificar Resposta</button>
                        <button class="btn btn-secondary" onclick="showAnswer()">üëÅÔ∏è Ver Resposta</button>
                        <button class="btn btn-secondary" onclick="clearSelection()">üóëÔ∏è Limpar</button>
                    </div>
                </div>
            `;
        }

        // Renderizar pergunta de m√∫ltipla escolha
        function renderMultipleChoiceQuestion() {
            const direction = gameState.currentQuestion.direction || 'en-pt';
            const isEnglishToPortuguese = direction === 'en-pt';

            const questionText = isEnglishToPortuguese ? gameState.currentQuestion.english : gameState.currentQuestion.portuguese;
            const correctAnswer = isEnglishToPortuguese ? gameState.currentQuestion.portuguese : gameState.currentQuestion.english;

            const options = generateMultipleChoiceOptions(correctAnswer, phrases, direction);
            const gameContent = document.getElementById('gameContent');

            const questionLabel = isEnglishToPortuguese ? "Qual o significado de:" : "What is the meaning of:";
            const instructionText = isEnglishToPortuguese ? "üéØ Escolha a tradu√ß√£o correta:" : "üéØ Choose the correct translation:";

            gameContent.innerHTML = `
                <div class="question">${questionLabel}</div>
                <div class="english-phrase">"${questionText}"</div>
                
                <div class="answer-area">
                    <h4>${instructionText}</h4>
                    <div class="multiple-choice-options" id="multipleChoiceOptions">
                        ${options.map((option, index) => `
                            <button class="choice-btn" onclick="selectMultipleChoice(\`${option}\`, ${index})" id="choice-${index}">
                                ${String.fromCharCode(65 + index)}) ${option}
                            </button>
                        `).join('')}
                    </div>
                    
                    <div class="game-actions">
                        <button class="btn btn-secondary" onclick="showAnswer()">üëÅÔ∏è Ver Resposta</button>
                    </div>
                </div>
            `;
        }
        // Selecionar op√ß√£o de m√∫ltipla escolha
        function selectMultipleChoice(selectedOption, optionIndex) {
            const direction = gameState.currentQuestion.direction || 'en-pt';
            const correctAnswer = direction === 'en-pt' ? gameState.currentQuestion.portuguese : gameState.currentQuestion.english;
            const isCorrect = selectedOption === correctAnswer;

            // Destacar a op√ß√£o selecionada
            const buttons = document.querySelectorAll('.choice-btn');
            buttons.forEach((btn, index) => {
                btn.disabled = true;
                if (index === optionIndex) {
                    btn.classList.add(isCorrect ? 'correct' : 'incorrect');
                }
                // Destacar a resposta correta se errou
                if (!isCorrect && btn.textContent.includes(correctAnswer)) {
                    btn.classList.add('correct');
                }
            });

            // Processar resultado (usar a mesma l√≥gica do checkAnswer)
            if (isCorrect) {
                const timeSpent = Date.now() - gameState.roundStartTime;
                const earnedPoints = calculateScore(gameState.currentQuestion.difficulty, true, timeSpent);

                gameState.score += earnedPoints;
                gameState.roundScore += earnedPoints;

                const xpGained = SCORE_SYSTEM.points[gameState.currentQuestion.difficulty] / 2;
                addXP(xpGained);

                updateStreak(true);
                playerStats.correctAnswers++;
                playerStats.totalScore += earnedPoints;

                showFeedback(`üéâ Perfeito! +${earnedPoints} pontos!`, 'correct');
                speak('Perfeito! Voc√™ acertou!', 'pt');
            } else {
                updateStreak(false);
                showFeedback(`‚ùå Incorreto! A resposta correta √©: "${correctAnswer}"`, 'incorrect');
                speak('Incorreto. A resposta correta √©:', 'pt');
                setTimeout(() => {
                    // Remover espa√ßos isolados (quando h√° espa√ßos entre cada letra)
                    const words = correctAnswer.split(' ');
                    const textToSpeak = words.every(word => word.length === 1)
                        ? correctAnswer.replace(/\s+/g, '')
                        : correctAnswer;
                    speak(textToSpeak, 'pt');
                }, 1500);
            }

            playerStats.questionsAnswered++;
            savePlayerStats();
            updateGameStatus();

            // Avan√ßar para pr√≥xima pergunta
            setTimeout(() => {
                if (gameState.availableQuestions.length > 0) {
                    nextQuestion();
                } else {
                    endGame();
                }
            }, 2000);
        }
        // Selecionar palavra
        function selectWord(word, buttonIndex) {/* adiciona palavra √† resposta */
            const button = document.getElementById(`word-${buttonIndex}`);
            if (button.disabled) return;

            gameState.selectedWords.push(word);
            button.disabled = true;

            updateSelectedWordsDisplay();
        }
        // Remover palavra selecionada
        function removeSelectedWord(wordIndex) {/* remove palavra da resposta */
            const word = gameState.selectedWords[wordIndex];
            gameState.selectedWords.splice(wordIndex, 1);

            // Re-enable the button
            const buttons = document.querySelectorAll('.word-btn');
            buttons.forEach(btn => {
                if (btn.textContent.trim() === word && btn.disabled) {
                    btn.disabled = false;
                    return;
                }
            });

            updateSelectedWordsDisplay();
        }
        // Atualizar √°rea de palavras selecionadas
        function updateSelectedWordsDisplay() {/* atualiza UI das palavras */
            const selectedWordsArea = document.getElementById('selectedWordsArea');

            if (gameState.selectedWords.length === 0) {
                selectedWordsArea.innerHTML = 'Clique nas palavras abaixo para formar a frase';
                selectedWordsArea.className = 'selected-words empty';
            } else {
                selectedWordsArea.innerHTML = gameState.selectedWords.map((word, index) =>
                    `<button class="selected-word" onclick="removeSelectedWord(${index})">${word}</button>`
                ).join('');
                selectedWordsArea.className = 'selected-words has-words';
            }
        }
        // Limpar sele√ß√£o atual
        function clearSelection() {/* limpa resposta */
            gameState.selectedWords = [];

            // Re-enable all buttons
            const buttons = document.querySelectorAll('.word-btn');
            buttons.forEach(btn => btn.disabled = false);

            updateSelectedWordsDisplay();
        }
        // Verificar resposta do usu√°rio
        function checkAnswer() {/* valida resposta */
            if (gameState.selectedWords.length === 0) {
                alert('Selecione algumas palavras primeiro!');
                return;
            }

            const direction = gameState.currentQuestion.direction || 'en-pt';
            const userAnswer = gameState.selectedWords.join(' ').toLowerCase().trim();
            const correctAnswerText = direction === 'en-pt' ? gameState.currentQuestion.portuguese : gameState.currentQuestion.english;
            const correctAnswer = correctAnswerText.toLowerCase().trim();

            const isCorrect = userAnswer === correctAnswer;

            if (isCorrect) {
                const timeSpent = Date.now() - gameState.roundStartTime;
                const earnedPoints = calculateScore(gameState.currentQuestion.difficulty, true, timeSpent);

                gameState.score += earnedPoints;
                gameState.roundScore += earnedPoints;

                // Adicionar XP baseado na dificuldade
                const xpGained = SCORE_SYSTEM.points[gameState.currentQuestion.difficulty] / 2;
                const leveledUp = addXP(xpGained);

                if (leveledUp) {
                    feedbackMsg += ` üÜô LEVEL UP!`;
                }

                // Atualizar estat√≠sticas
                updateStreak(true);
                playerStats.correctAnswers++;
                playerStats.totalScore += earnedPoints;

                let feedbackMsg = `üéâ Perfeito! +${earnedPoints} pontos!`;

                // Mensagens especiais
                if (timeSpent < 5000) {
                    feedbackMsg += ' ‚ö° Resposta rel√¢mpago!';
                }
                if (gameState.currentStreak >= 3) {
                    feedbackMsg += ` üî• Sequ√™ncia de ${gameState.currentStreak}!`;
                }

                showFeedback(feedbackMsg, 'correct');
                speak('Perfeito! Voc√™ acertou!', 'pt');

                const buttons = document.querySelectorAll('.word-btn');
                buttons.forEach(btn => btn.disabled = true);

                setTimeout(() => {
                    if (gameState.availableQuestions.length > 0) {
                        nextQuestion();
                    } else {
                        endGame();
                    }
                }, 2000);

            } else {
                updateStreak(false);
                showFeedback(`‚ùå Incorreto! A resposta correta √©: "${correctAnswerText}"`, 'incorrect');
                speak('Incorreto. A resposta correta √©:', 'pt');
                setTimeout(() => {
                    const lang = direction === 'en-pt' ? 'pt' : 'en';
                    // Remover espa√ßos isolados (quando h√° espa√ßos entre cada letra)
                    const words = correctAnswerText.split(' ');
                    const textToSpeak = words.every(word => word.length === 1)
                        ? correctAnswerText.replace(/\s+/g, '')
                        : correctAnswerText;
                    speak(textToSpeak, lang);
                }, 1500);
            }

            // Atualizar estat√≠sticas gerais
            playerStats.questionsAnswered++;
            savePlayerStats();
            updateGameStatus();

        }
        // Mostrar resposta correta
        function showAnswer() {/* revela resposta */
            const questionType = gameState.currentQuestion.type || 'selection';

            if (questionType === 'multiple') {
                // Para m√∫ltipla escolha, destacar a resposta correta
                const buttons = document.querySelectorAll('.choice-btn');
                buttons.forEach(btn => {
                    if (btn.textContent.includes(gameState.currentQuestion.portuguese)) {
                        btn.classList.add('correct');
                    }
                    btn.disabled = true;
                });
            } else {
                // C√≥digo existente para sele√ß√£o
                const direction = gameState.currentQuestion.direction || 'en-pt';
                const correctAnswerText = direction === 'en-pt' ? gameState.currentQuestion.portuguese : gameState.currentQuestion.english;

                gameState.selectedWords = correctAnswerText.split(' ');
                updateSelectedWordsDisplay();
                const buttons = document.querySelectorAll('.word-btn');
                buttons.forEach(btn => btn.disabled = true);
            }

            const direction = gameState.currentQuestion.direction || 'en-pt';
            const correctAnswerText = direction === 'en-pt' ? gameState.currentQuestion.portuguese : gameState.currentQuestion.english;

            showFeedback(`üí° A resposta √©: "${correctAnswerText}"`, 'correct');
            const answerLang = direction === 'en-pt' ? 'pt' : 'en';
            const introLang = direction === 'en-pt' ? 'pt' : 'en';
            const introText = direction === 'en-pt' ? 'A resposta √©:' : 'The answer is:';

            speak(introText, introLang);
            setTimeout(() => {
                // Remover espa√ßos isolados (quando h√° espa√ßos entre cada letra)
                const words = correctAnswerText.split(' ');
                const textToSpeak = words.every(word => word.length === 1)
                    ? correctAnswerText.replace(/\s+/g, '')
                    : correctAnswerText;
                speak(textToSpeak, answerLang);
            }, 1000);
        }
        // Resetar rodada atual
        function resetRound() {/* reinicia pergunta */
            gameState.selectedWords = [];
            updateSelectedWordsDisplay();

            // Re-enable all buttons
            const buttons = document.querySelectorAll('.word-btn');
            buttons.forEach(btn => btn.disabled = false);

            hideFeedback();
        }
        // Finalizar jogo
        function endGame() {
            const percentage = Math.round((gameState.score / gameState.totalQuestions) * 100);

            if (percentage === 100) {
                gameState.roundScore += SCORE_SYSTEM.bonuses.perfectRound;
                playerStats.totalScore += SCORE_SYSTEM.bonuses.perfectRound;
            }

            playerStats.gamesPlayed++;
            playerStats.scoreHistory.push({
                date: new Date().toISOString(),
                score: gameState.roundScore,
                percentage: percentage,
                questions: gameState.totalQuestions
            });

            if (playerStats.scoreHistory.length > 50) {
                playerStats.scoreHistory = playerStats.scoreHistory.slice(-50);
            }

            savePlayerStats();

            const template = document.getElementById('endGameTemplate');
            const clone = template.content.cloneNode(true);

            let message = '';
            if (percentage >= 90) {
                message = 'üèÜ Excelente! Voc√™ √© um mestre!';
            } else if (percentage >= 70) {
                message = 'üéâ Muito bem! Continue assim!';
            } else if (percentage >= 50) {
                message = 'üëç Bom trabalho! Pratique mais!';
            } else {
                message = 'üí™ Continue tentando! A pr√°tica leva √† perfei√ß√£o!';
            }

            clone.querySelector('.end-message').textContent = message;
            clone.getElementById('roundScore').textContent = `${gameState.roundScore} pontos`;
            clone.getElementById('correctAnswers').textContent = `${gameState.score}/${gameState.totalQuestions} (${percentage}%)`;
            clone.getElementById('maxStreak').textContent = `${playerStats.maxStreak} acertos`;
            clone.getElementById('totalScore').textContent = `${playerStats.totalScore} pontos`;

            if (percentage === 100) {
                clone.getElementById('perfectBonus').textContent = `+${SCORE_SYSTEM.bonuses.perfectRound} pontos`;
                clone.getElementById('perfectBonusContainer').style.display = 'flex';
            }

            const gameContent = document.getElementById('gameContent');
            gameContent.innerHTML = '';
            gameContent.appendChild(clone);

            document.getElementById('resetBtn').style.display = 'none';
            gameState.gameActive = false;

            speak(`Jogo conclu√≠do! Voc√™ fez ${gameState.roundScore} pontos.`, 'pt');
        }

        // ==========================================
        // 10. FUN√á√ïES DE ESTAT√çSTICAS
        // ==========================================
        // Mostrar tela de estat√≠sticas
        function showStats() {/* exibe stats detalhadas */
            const gameContent = document.getElementById('gameContent');
            const template = document.getElementById('statsTemplate');
            const clone = template.content.cloneNode(true);

            const avgScore = playerStats.gamesPlayed > 0 ? Math.round(playerStats.totalScore / playerStats.gamesPlayed) : 0;
            const accuracy = playerStats.questionsAnswered > 0 ? Math.round((playerStats.correctAnswers / playerStats.questionsAnswered) * 100) : 0;

            clone.querySelector('[data-stat="totalScore"]').textContent = playerStats.totalScore;
            clone.querySelector('[data-stat="gamesPlayed"]').textContent = playerStats.gamesPlayed;
            clone.querySelector('[data-stat="avgScore"]').textContent = avgScore;
            clone.querySelector('[data-stat="accuracy"]').textContent = accuracy + '%';
            clone.querySelector('[data-stat="maxStreak"]').textContent = playerStats.maxStreak;
            clone.querySelector('[data-stat="correctAnswers"]').textContent = playerStats.correctAnswers;
            clone.querySelector('[data-stat="level"]').textContent = playerStats.level;
            clone.querySelector('[data-stat="currentXP"]').textContent = playerStats.currentXP;
            clone.querySelector('[data-stat="xpNeeded"]').textContent = getXPNeededForNextLevel(playerStats.level);
            clone.querySelector('[data-stat="xpProgress"]').style.width = getProgressPercentage() + '%';
            clone.querySelector('[data-stat="totalXP"]').textContent = playerStats.totalXP;

            // Lida com os t√≠tulos
            if (playerStats.titles.length > 0) {
                const titlesCard = clone.getElementById('titlesCard');
                titlesCard.style.display = '';
                clone.querySelector('[data-stat="titlesCount"]').textContent = playerStats.titles.length;
                clone.querySelector('[data-stat="titlesList"]').textContent = playerStats.titles.join(', ');
            }

            // Limpa e insere no DOM
            gameContent.innerHTML = '';
            gameContent.appendChild(clone);
        }
        // Resetar todas as estat√≠sticas
        function resetStats() {/* limpa dados salvos */
            if (confirm('Tem certeza que deseja resetar todas as estat√≠sticas?')) {
                playerStats = {
                    totalScore: 0,
                    gamesPlayed: 0,
                    questionsAnswered: 0,
                    correctAnswers: 0,
                    streak: 0,
                    maxStreak: 0,
                    scoreHistory: []
                };
                savePlayerStats();
                showStats();
            }
        }
        // ==========================================
        // 11. FUN√á√ïES DE FEEDBACK VISUAL
        // ==========================================
        // Mostrar feedback na tela
        function showFeedback(message, type) {/* exibe mensagem */
            const feedback = document.getElementById('feedback');
            feedback.textContent = message;
            feedback.className = `feedback ${type}`;
            feedback.style.display = 'block';
        }
        // Esconder feedback
        function hideFeedback() {/* oculta mensagem */
            document.getElementById('feedback').style.display = 'none';
        }
        // ==========================================
        // 12. FUN√á√ïES DE GERENCIAMENTO DE FRASES
        // ==========================================
        // Atualizar labels do modal conforme dire√ß√£o
        function updateModalLabels() {
            const direction = document.getElementById('questionDirection').value;
            const labelEnglish = document.getElementById('labelEnglish');
            const labelPortuguese = document.getElementById('labelPortuguese');

            if (direction === 'pt-en') {
                labelPortuguese.textContent = 'Frase em Portugu√™s:';
                labelEnglish.textContent = 'Tradu√ß√£o em Ingl√™s:';
            } else {
                labelPortuguese.textContent = 'Tradu√ß√£o em Portugu√™s:';
                labelEnglish.textContent = 'Frase em Ingl√™s:';
            }
        }
        // Carregar lista de frases
        function loadPhrasesList() {/* exibe lista no gerenciador */
            const list = document.getElementById('phrasesList');

            if (phrases.length === 0) {
                list.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">Nenhuma frase cadastrada. Adicione sua primeira frase!</p>';
                return;
            }

            list.innerHTML = phrases.map(phrase => `
                <div class="phrase-item">
                    <div class="phrase-content">
                        <div class="phrase-english">${phrase.english}</div>
                        <div class="phrase-portuguese">${phrase.portuguese}</div>
                        <!-- ADICIONAR ESTAS LINHAS: -->
                        <div class="phrase-meta">
                            <span class="category-badge">${CATEGORIES[phrase.category] || phrase.category}</span>
                            <span class="difficulty-badge difficulty-${phrase.difficulty}">${phrase.difficulty}</span>
                        </div>
                    </div>
                    <div class="phrase-actions">
                        <button class="btn btn-secondary btn-small" onclick="editPhrase(${phrase.id})">‚úèÔ∏è Editar</button>
                        <button class="btn btn-danger btn-small" onclick="deletePhrase(${phrase.id})">üóëÔ∏è Excluir</button>
                    </div>
                </div>
            `).join('');
        }
        // Abrir modal de adi√ß√£o
        function openAddModal() {/* modal para nova frase */
            editingId = null;
            document.getElementById('modalTitle').textContent = 'Adicionar Nova Frase';
            document.getElementById('englishPhrase').value = '';
            document.getElementById('portugueseTranslation').value = '';
            document.getElementById('questionDirection').value = '';
            document.getElementById('customOptionsContainer').style.display = 'none';
            document.getElementById('customOptions').value = '';
            updateModalLabels();
            document.getElementById('phraseModal').style.display = 'block';
        }
        // Editar frase existente
        function editPhrase(id) {/* modal para editar */
            const phrase = phrases.find(p => p.id === id);
            if (!phrase) return;

            editingId = id;
            document.getElementById('modalTitle').textContent = 'Editar Frase';
            document.getElementById('englishPhrase').value = phrase.english;
            document.getElementById('portugueseTranslation').value = phrase.portuguese;
            // ADICIONAR ESTAS LINHAS:
            document.getElementById('categorySelect2').value = phrase.category || '';
            document.getElementById('difficultySelect2').value = phrase.difficulty || '';
            document.getElementById('gameTypeSelect').value = phrase.type || 'selection';
            //para mudar a dire√ßao da pergunta
            document.getElementById('questionDirection').value = phrase.direction || 'en-pt';
            if (phrase.type === 'multiple' && phrase.customOptions) {
                document.getElementById('customOptions').value = phrase.customOptions.join('\n');
                document.getElementById('customOptionsContainer').style.display = 'block';
            } else {
                document.getElementById('customOptionsContainer').style.display = 'none';
            }
            toggleCustomOptions(); // Chama a fun√ß√£o para mostrar/ocultar o campo
            updateModalLabels();
            document.getElementById('phraseModal').style.display = 'block';

        }
        // Excluir frase
        async function deletePhrase(id) {/* remove frase */
            if (confirm('Tem certeza que deseja excluir esta frase?')) {
                phrases = phrases.filter(p => p.id !== id);
                await savePhrases();
                loadPhrasesList();
            }
        }
        // Limpar todas as frases
        async function clearAllPhrases() {/* remove todas */
            if (confirm('Tem certeza que deseja excluir todas as frases? Esta a√ß√£o n√£o pode ser desfeita.')) {
                phrases = [];
                await savePhrases();
                loadPhrasesList();
            }
        }
        // Fechar modal
        function closeModal() {/* fecha janela modal */
            document.getElementById('phraseModal').style.display = 'none';
        }
        // Fecha o modal ao clicar fora do conte√∫do
        window.addEventListener('click', function (event) {
            const modal = document.getElementById('phraseModal');
            const modalContent = modal.querySelector('.modal-content');

            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });

        // Mostrar/ocultar campo de op√ß√µes customizadas
        function toggleCustomOptions() {
            const gameType = document.getElementById('gameTypeSelect').value;
            const customContainer = document.getElementById('customOptionsContainer');

            if (gameType === 'multiple') {
                customContainer.style.display = 'block';
            } else {
                customContainer.style.display = 'none';
            }
        }
        // ==========================================
        // 13. EVENT LISTENERS
        // ==========================================
        // Event listener para mostrar/ocultar op√ß√µes customizadas
        document.getElementById('gameTypeSelect').addEventListener('change', toggleCustomOptions);
        document.getElementById('questionDirection').addEventListener('change', updateModalLabels);
        // Form submission, Formul√°rio de frases
        document.getElementById('phraseForm').addEventListener('submit', async function (e) {

            e.preventDefault();

            const englishPhrase = document.getElementById('englishPhrase').value.trim();
            const portugueseTranslation = document.getElementById('portugueseTranslation').value.trim();
            const category = document.getElementById('categorySelect2').value;
            const difficulty = document.getElementById('difficultySelect2').value;
            const gameType = document.getElementById('gameTypeSelect').value;
            const questionDirection = document.getElementById('questionDirection').value;
            const customOptions = document.getElementById('customOptions').value.trim();

            if (!englishPhrase || !portugueseTranslation || !category || !difficulty || !gameType || !questionDirection) {
                alert('Por favor, preencha todos os campos.');
                return;
            }

            if (!englishPhrase || !portugueseTranslation || !category || !difficulty) {
                alert('Por favor, preencha todos os campos.');
                return;
            }
            // Adicione esta valida√ß√£o ap√≥s verificar se os campos est√£o preenchidos
            if (gameType === 'multiple') {
                if (!customOptions) {
                    alert('Para perguntas de m√∫ltipla escolha, adicione pelo menos as op√ß√µes de resposta.');
                    return;
                }

                const optionsArray = customOptions.split('\n').map(opt => opt.trim()).filter(opt => opt);
                if (optionsArray.length < 2) {
                    alert('Adicione pelo menos 2 op√ß√µes de resposta.');
                    return;
                }

                if (!optionsArray.includes(portugueseTranslation)) {
                    alert('A resposta correta deve estar inclu√≠da nas op√ß√µes.');
                    return;
                }
            }
            // Substitua a parte onde voc√™ salva a frase por:

            const customOptionsArray = customOptions ? customOptions.split('\n').map(opt => opt.trim()).filter(opt => opt) : null;

            if (editingId) {
                const phrase = phrases.find(p => p.id === editingId);
                if (phrase) {
                    phrase.english = englishPhrase;
                    phrase.portuguese = portugueseTranslation;
                    phrase.category = category;
                    phrase.difficulty = difficulty;
                    phrase.type = gameType;
                    phrase.direction = questionDirection;
                    phrase.customOptions = customOptionsArray;
                }
            } else {
                const newId = Math.max(...phrases.map(p => p.id), 0) + 1;
                phrases.push({
                    id: newId,
                    english: englishPhrase,
                    portuguese: portugueseTranslation,
                    category: category,
                    difficulty: difficulty,
                    type: gameType,
                    direction: questionDirection,
                    customOptions: customOptionsArray
                });
            }

            await savePhrases();
            closeModal();
            loadPhrasesList();
        });
        // ==========================================
        // 14. INICIALIZA√á√ÉO FINAL
        // ==========================================

        // Chamada da fun√ß√£o principal
        init();
    </script>
</body>

</html>